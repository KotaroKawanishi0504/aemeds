# ナビ（ヘッダー）とフッターのフラグメント作成手順

## 前提：フラグメントとは

- **ヘッダー**と**フッター**は、**別ページの内容を読み込んで表示**しています（フラグメント）。
- 表示時に `{パス}.plain.html` を取得します（例: `/nav.plain.html`, `/footer.plain.html`）。
- `paths.json` で `/content/marubeni/jp/` を `/` にマッピングしているため、AEM 上で次のページを作成すると、サイト上では `/nav`・`/footer` として配信されます。
  - AEM: `/content/marubeni/jp/nav` → サイト: `/nav`
  - AEM: `/content/marubeni/jp/footer` → サイト: `/footer`

---

## パスの決まり方（metadata）

| 対象   | 使う metadata 名 | 指定しない場合のデフォルト |
|--------|-------------------|-----------------------------|
| ナビ   | `nav`             | `/nav`                      |
| フッター | `footer`          | `/footer`                   |

- 各ページの **メタデータ** で `nav` や `footer` を指定すると、そのページだけ別パスを参照できます。
- 指定しなければ、全ページで **デフォルトの `/nav`・`/footer`** が使われます。
- いまの設定のまま使う場合は、**AEM で `/content/marubeni/jp/nav` と `/content/marubeni/jp/footer` のページを作成**すれば、そのままデフォルトパスで読み込まれます。

---

# 1. ナビ（ヘッダー）用ページの作成

## 重要：ナビページは「通常のコンテンツページ」で作成する

- ナビページは **通常の EDS コンテンツページ**（セクション＋ブロックで構成）で作成してください。
- **Spreadsheet（テーブル）のみのページにしないでください。** テーブルのみのページでは `.plain.html` がフル HTML（`<meta>` や `<title>` を含む）を返し、ヘッダーが真っ白になります。
- `.plain.html` の配信では **本文のセクションのみ** が返るようにしてください（`<head>` やフルドキュメントが含まれると表示されません）。参照用の構造は [nav-fragment-reference.plain.html](./nav-fragment-reference.plain.html) を参照してください。

## 1-1. AEM でページを作成する

1. AEM の**サイト**（またはコンテンツツリー）を開く。
2. **`/content/marubeni/jp`** の下に新しいページを追加する。
3. **タイトル**: 例）`ナビ` または `Nav`
4. **名前（URL 用）**: **`nav`** にする（小文字）。
   - これで AEM パスが `/content/marubeni/jp/nav` になり、サイトでは `/nav` として配信されます。
5. **通常のコンテンツ用テンプレート**を選び、作成する（Spreadsheet 専用テンプレートは使わない）。

## 1-2. ナビの「中身」の構成（3 ブロック）

ヘッダー用コードは、フラグメントの**先頭 3 つのセクション**を次のように使います。

| 順番 | 役割        | クラス名（コード側で付与） | 使うブロック | 入れる内容の例 |
|------|-------------|----------------------------|--------------|----------------|
| 1 番目 | ブランド     | `nav-brand`                | **Image**（Link 任意） | ロゴ画像＋「Link (optional)」にトップ URL |
| 2 番目 | メニュー     | `nav-sections`             | リスト／テキスト | メニュー項目のリスト（ul > li） |
| 3 番目 | ツール類     | `nav-tools`                | テキスト／ボタン | 検索・言語切替など |

### 1 番目：ブランド（ロゴ）— **Image ブロックを使う（必須）**

- **1 セクション目は必ず「Image」ブロック**で作成してください。
  - Image ブロックでロゴ画像を配置し、プロパティの **「Link (optional)」** にトップページなどの URL を指定します。
  - これにより `.plain.html` に `<a><picture>...</picture></a>` が出力され、ヘッダーがブランドリンクとして認識します。
- **Button ブロックを 1 セクション目に使わないでください。**
  - 1 セクション目が Button の場合、ヘッダー用コードがブランドリンクを検出できず、**「Home」というフォールバックが表示されます。** ロゴ＋リンクには Image ブロック（Link 指定）を使用してください。

### 2 番目：メニュー（nav-sections）

- **2 番目のセクション**に、**リスト形式**のメニューを入れます。
- コードは **`.default-content-wrapper > ul > li`** を想定しています。
- AEM 上では例えば次のようにします。
  - セクション内に「リスト」ブロックや、**テーブルで 1 列にメニュー項目**を並べる。
  - 1 行 = 1 項目。リンクテキストと URL を列に書く。
- ドロップダウンにしたい項目は、**その項目の下に子リスト（入れ子の ul > li）** として書きます。  
  - 例: 「会社情報」の下に「社長メッセージ」「沿革」などの子項目。

例（HTML イメージ）:

```html
<ul>
  <li><a href="/jp/company/">会社情報</a></li>
  <li>
    ニュース
    <ul>
      <li><a href="/jp/news/release/">リリース</a></li>
      <li><a href="/jp/news/info/">お知らせ</a></li>
    </ul>
  </li>
  <li><a href="/jp/business/">事業紹介</a></li>
</ul>
```

AEM のブロック／テーブルで、このような「親項目 → 子リスト」になるように組むと、デスクトップでドロップダウン、モバイルで開閉メニューとして動きます。

### 3 番目：ツール（検索・言語など）

- **3 番目のセクション**に、検索リンク・言語切替（Ja/En）などを配置します。
- リンクやボタンとして追加すれば十分です。

## 1-3. プレビューで確認

- ナビを表示するページ（例: TOP）をプレビューし、ヘッダーにロゴ・メニュー・ツールが表示されるか確認します。
- 表示されない場合は、**ナビページの URL が `/nav` になっているか**（AEM でページ名が `nav` か）と、**セクションが 3 つあるか**を確認してください。

---

# 2. フッター用ページの作成

## 2-1. AEM でページを作成する

1. 同じく **`/content/marubeni/jp`** の下に新しいページを追加する。
2. **タイトル**: 例）`フッター` または `Footer`
3. **名前（URL 用）**: **`footer`** にする（小文字）。
   - これで AEM パスが `/content/marubeni/jp/footer`、サイトでは `/footer` として配信されます。
4. テンプレートを選び、作成する。

## 2-2. フッターの「中身」

- フッター用コードは、**フラグメントの先頭の子要素をそのまま**フッター領域に並べます。
- 構成は自由です。例:
  - リンクを複数並べる（会社情報、IR、お問い合わせなど）
  - コピーライト表記
  - SNS アイコンへのリンク
- 複数ブロック（セクション）に分けても、1 ブロックにまとめても構いません。見た目は `blocks/footer/footer.css` で調整できます。

## 2-3. プレビューで確認

- フッターを表示するページをプレビューし、フッターにリンクやコピーライトが表示されるか確認します。

---

# 3. 別パスを使いたい場合（metadata の指定）

- ナビやフッターを **`/nav`・`/footer` 以外のパス**にしたい場合は、**各ページのメタデータ**で指定します。
- 例: 英語版だけ別ナビを使う
  - そのページのメタデータに **名前: `nav`**、**値: `/en/nav`** のように設定する。
- 指定がなければ、常に **デフォルトの `/nav`・`/footer`** が使われます（＝`/content/marubeni/jp/nav` と `/content/marubeni/jp/footer` のページが読み込まれます）。

---

# 4. トラブルシューティング

## 4-1. ヘッダーが真っ白・下線だけの場合

- **現象**: ヘッダーに下線だけ表示され、ロゴ・メニューが出ない。
- **確認**: ブラウザの開発者ツールで `<nav id="nav">` の子要素を確認してください。`<meta>` や `<title>` が nav の直下に入っている場合は、**ナビの .plain.html がフル HTML を返している**か、**ナビページが Spreadsheet のみ**になっています。
- **対応**:
  1. ナビページを **通常のコンテンツページ** に作り直す（上記「重要」を参照）。
  2. 1 セクション目：**Image ブロック**でロゴを配置し、「Link (optional)」にトップ URL を指定。
  3. 2 セクション目：メニュー（リストブロックで ul > li になるように配置）。
  4. 3 セクション目：ツール（検索・言語などのリンク）。
  5. AEM の配信設定で、該当ページの `.plain.html` が **本文のセクションのみ** を返すようにする。

## 4-2. ヘッダーに不要な「Home」が表示される場合

- **現象**: ロゴの左や上に「Home」というリンクが表示される。
- **原因**: ナビの **1 セクション目が Button ブロック**のままになっているためです。`nav.plain.html` の 1 セクション目に Image ブロックの出力（`<a><picture>...</picture></a>`）がないと、ヘッダー用コードがブランドリンクを検出できず「Home」フォールバックを表示します。
- **確認**: ブラウザで `https://(あなたのオーサー)/content/marubeni/jp/nav.plain.html` を開き、1 セクション目が `<div class="image">` を含む Image ブロックの HTML になっているか確認してください。`<p><a href="#">Button</a></p>` だけの場合は Button のままです。
- **対応**: AEM のナビページを開き、**1 セクション目を Image ブロックに差し替えてください**。ロゴ画像を設定し、「Link (optional)」にトップページの URL（例: `https://www.marubeni.com/jp/`）を入力して保存・公開します。

---

# 5. チェックリスト

- [ ] AEM で `/content/marubeni/jp/nav` のページを作成し、ページ名が `nav` になっている
- [ ] ナビページの 1 番目に **Image ブロック**（ロゴ＋「Link (optional)」にトップ URL）を入れた（Button ではない）
- [ ] ナビページの 2 番目にメニュー（ul > li になる構成）を入れた
- [ ] ナビページの 3 番目に検索・言語などツールを入れた
- [ ] AEM で `/content/marubeni/jp/footer` のページを作成し、ページ名が `footer` になっている
- [ ] フッターページにリンク・コピーライトなどを入れた
- [ ] TOP など実際のページでプレビューし、ヘッダー・フッターが表示されることを確認した

以上で、ナビとフッターのフラグメント設定は完了です。

---

# 参考：ナビフラグメントの期待構造

- ヘッダー用コードが期待する `.plain.html` の内容（本文のみ）の例は [nav-fragment-reference.plain.html](./nav-fragment-reference.plain.html) を参照してください。
