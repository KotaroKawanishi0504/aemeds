# 画面を並べて確認できない中で精度を上げる

参照サイトと自実装を、同じビューポートで並べてリアルタイムで見られない場合でも、**数値比較とスクリーンショット比較**で差分を特定し、1 変更ごとに比較して精度を上げる。

## 前提

- 「結果の画面確認ができない」＝本家と自実装を横に並べて同じ幅で見る運用が難しい、という意味とする。
- 代わりに: (1) **数値の正解を先に取り**、(2) **実装はその数値・式だけで合わせ**、(3) **同じ条件でスクリーンショットを撮って diff で比較**する。

## 手順

### 1. 数値の正解を先に取る

- **レイアウト**: 複数ビューポートでレイアウト計測スクリプトを実行し、本家のコンテナ幅・グリッド幅・gap・祖先の padding を JSON/MD に残す。
- **フォント・色**: 本家の CSS と 1 ビューポートの Computed を取得し、仕様書に「Source: 〇〇」と書く。
- 実装では「なんとなく 24px」を避け、**必ずこの成果物の数値だけを参照**する。

### 2. 実装は数値・式で合わせる

- テーマやブロックの CSS は、上記の数値または式だけを根拠に書く。出典をコメントに残す。

### 3. 視覚の代わりにスクリーンショット比較

- **同じビューポート**（例: 1280×800）で、参照サイトの該当ブロックと自実装の該当ブロックをキャプチャする。
- 例: `node scripts/compare-cards-screenshots.js` → `drafts/tmp/screenshot-compare/reference-cards.png`, `aem-cards.png`, `--diff` で diff.png。
- 毎回 **reference / aem / diff** を確認する。diff が縮むか、数値が一致するかで正しさを判断する。

### 4. 違うときは数値に戻る

- 「ギャップが違う」→ 計測結果の gap と自実装の gap を比較する。
- 「幅が違う」→ そのビューポートの本家の幅と、自実装のセクション幅・グリッド幅を比較する。中間幅で本家が fluid なら、固定値ではなく fluid の式に変更する。

### 5. 1 ビューポートだけを信じない

- レイアウトは**複数幅で計測**し、固定か fluid かを判断してから式を決める。単一ビューポートの design-extract だけだと、中間幅でずれる。

### 6. 分析ドキュメントだけに頼らない

- フォント・色は、可能なら**本家の CSS と Computed** で必ず 1 回は確認する。スタイル分析ドキュメントが古い・違うことがある。

## イテレーション

- レイアウトを変えたら: レイアウト計測を再実行するか、該当ビューポートの数値を手で比較する。
- スタイルを変えたら: 比較スクリプトを再実行し、diff が縮むか確認する。
- **「1 変更 → 1 比較（数値 or スクショ）」**をルールにする。複数変更をまとめてやると、どれが効いたか分からなくなる。

## 正しさの基準を「出典付き」にする

- すべての見た目・レイアウトの値に**本家のどの成果物から取ったか**を紐付ける（仕様書の Source files、layout-collect-*.md の表）。
- 後から「なぜこの数値か」を追えるようにする。これにより、画面を並べて見られなくても、数値と出典で検証可能になる。

## よくある落とし穴

- **単一ビューポートで結論を出す** → 本家が fluid だと固定値では合わない。複数幅で計測する。
- **分析ドキュメントのフォントをそのまま使う** → 本家が差し替えていることがある。本家 CSS を確認する。
- **比較を飛ばして実装だけ進める** → 差分が蓄積する。小さく変更して都度比較する。
